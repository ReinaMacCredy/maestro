# Maestro Plugin - Architecture Overview

AI workflow plugin for structured development: planning (Conductor), issue tracking (Beads), and execution (TDD).

## Key Entry Points

| Entry | Purpose |
|-------|---------|
| `ds` / `/conductor-design` | Start Double Diamond design session |
| `/conductor-newtrack` | Generate spec + plan + beads from design |
| `/conductor-implement` | Execute tasks with TDD |
| `/conductor-finish` | Complete track, extract learnings, archive |
| `fb` / `rb` | File/review beads from plan |
| `skills/agent-coordination/` | Multi-agent file coordination (optional) |

## Directory Structure

```
maestro/
├── skills/           # 15 skill directories (SKILL.md each)
├── skills/conductor/references/commands/         # Slash command definitions (.md)
├── skills/        # Multi-step workflow definitions
├── conductor/        # Project context + tracks
│   ├── product.md, tech-stack.md, workflow.md
│   ├── CODEMAPS/     # Architecture documentation (this directory)
│   └── tracks/<id>/  # design.md, spec.md, plan.md per track
├── agents/           # Agent persona definitions
└── .beads/           # Issue tracker storage
```

## Data Flow

```
ds → design.md → /conductor-newtrack → spec.md + plan.md
                                              ↓
                                       fb → .beads/ (epics + issues)
                                              ↓
                              /conductor-implement → TDD cycle → done
                                              ↓
                              /conductor-finish → LEARNINGS.md → archive
```

## Beads-Conductor Integration

Zero manual `bd` commands in the happy path:

| Point | Conductor Command | Beads Action |
|-------|-------------------|--------------|
| Preflight | All | Mode detect (SA/MA), validate bd |
| Claim | `/conductor-implement` | `bd update --status in_progress` |
| Close | `/conductor-implement` | `bd close --reason completed` |
| Sync | All (session end) | `bd sync` with retry |
| Compact | `/conductor-finish` | AI summaries for closed issues |

**SA Mode:** Direct `bd` CLI calls (default)
**MA Mode:** Village MCP server for multi-agent coordination

## Core Skills

| Skill | Trigger | Role |
|-------|---------|------|
| `conductor` | `/conductor-*` | Planning methodology + CODEMAPS |
| `design` | `ds` | Double Diamond + Party Mode |
| `beads` | `bd`, `fb`, `rb` | Issue tracking, file/review beads |
| `test-driven-development` | `tdd` | RED-GREEN-REFACTOR |

## Common Tasks

| Task | How |
|------|-----|
| Start new feature | `ds` → design → `/conductor-newtrack` |
| Find work | `bd ready --json` |
| Execute task | `/conductor-implement` (auto-claims from beads) |
| Complete track | `/conductor-finish` (extracts learnings, archives) |
| Add a skill | Create `skills/<name>/SKILL.md` with frontmatter |
| Add a command | Create `skills/conductor/references/commands/<name>.md` |
| Regenerate CODEMAPS | `/conductor-finish` (Phase 6: CODEMAPS Regeneration) |
| Coordinate parallel agents | See `skills/agent-coordination/` (optional, requires agent_mail MCP) |

## Gotchas

- `bv` without `--robot-*` flags launches TUI and hangs agents
- `bd` should use `--json` for structured output
- Skills require YAML frontmatter with `name` and `description`
- Never write production code without a failing test first (TDD iron law)
- CODEMAPS are auto-regenerated by `/conductor-finish`
