<!-- AUTO-GENERATED by /conductor-finish. Do not edit manually. -->

# Conductor Learnings

Knowledge extracted from completed tracks.

## About This File

This file is auto-updated by `/conductor-finish`.
Contains reusable learnings from completed tracks.

**Do not edit manually** - changes may be overwritten.

---

## Commands

- `tail -n +N file` - Strip first N-1 lines (useful for removing YAML frontmatter)
- `rm -rf skills/X .claude/skills/X` - Delete both hard-linked paths when removing skills
- `bd compact --analyze --json` - Find beads needing summaries
- `bd compact --apply --id <id> --summary "<text>"` - Apply AI summary to bead
- `bd count --status closed --json` - Count closed beads for cleanup threshold
- `bd cleanup --older-than 0 --limit <n> --force` - Remove oldest closed beads
- `bd update <id> --status in_progress` - Claim task in SA mode
- `bd close <id> --reason completed|skipped|blocked` - Close with explicit reason
- `bv --robot-status` - Check Village MCP status (use --robot-* flags to avoid TUI hang)
- `/conductor-implement --tdd` - Enable RED/GREEN/REFACTOR checkpoint tracking

## Gotchas

- Hard-linked directories (skills/ ↔ .claude/skills/) - updating one updates both, but explicitly delete both
- Thin skill stubs must include keyword-rich descriptions for AI trigger matching
- Delete operations must wait for reference replacements - deleting too early causes broken references
- Phase 3 (Knowledge Merge) is required - if it fails, stop workflow
- Phases 1 & 2 are best-effort - failures should log warnings but continue
- Context Refresh (Phase 4) can be skipped with --skip-refresh flag
- User input A/K must be mapped to JSON values "archive"/"keep"
- Atomic writes use $$ (PID) suffix for temp files to prevent collisions
- CODEMAPS loaded at design session start for codebase context
- docs: and chore: commits don't bump version (changelog only)
- Skill versions in SKILL.md frontmatter are manually updated (not automated)
- HALT vs Degrade: `bd` unavailable = HALT; Village unavailable in MA = degrade to SA
- Session lock staleness: heartbeat protocol (5 min updates); stale = >10 min without heartbeat
- Subagent bd access: read-only (show, ready, list); writes return to main agent
- Idempotency: `bd update` and `bd close` are idempotent; `bd create` is NOT
- planTasks mapping: bidirectional - keep planTasks and beadToTask in sync

## Patterns

- **6-Phase Finish Workflow:** Pre-flight → Thread Compaction → Beads Compaction → Knowledge Merge → Context Refresh → Archive → CODEMAPS
- **Smart Skip:** Each phase checks if work exists before running
- **Resume Capability:** State files track progress for interrupted workflows
- **A/K Archive Choice:** Archive (move to archive/) / Keep (stay active)
- **State Files First:** Create metadata.json, .track-progress.json, .fb-progress.json in Phase 1.3 BEFORE spec/plan generation
- **Collective State Validation:** Treat 3 state files as atomic unit - HAS_STATE = 0 (none), 1 (partial), 2 (all)
- **Double Diamond Phases:** DISCOVER (diverge) → DEFINE (converge) → DEVELOP (diverge) → DELIVER (converge)
- **A/P/C Checkpoints:** At each phase end: [A] Advanced, [P] Party (multi-agent), [C] Continue
- **Unified Track Creation:** /conductor-newtrack includes spec, plan, beads filing, AND review in one flow
- **Conventional Commits Versioning:** feat: → minor, fix: → patch, feat!: → major
