# Learnings: ux-automation_20251227

<!-- Auto-generated by /conductor-finish -->

## Commands

- `jq '.workflow.state = "ARCHIVED"' metadata.json > tmp && mv tmp metadata.json` - Update workflow state atomically
- `git branch --show-current` - Get current branch for preflight checks
- `git status --porcelain` - Check for dirty state (empty = clean)
- `git show-ref --verify --quiet "refs/heads/$BRANCH"` - Check if branch exists
- `git fetch origin 2>/dev/null || true` - Fetch without failing on offline
- State transitions via `bd close <id> --reason completed` to trigger IMPLEMENTING → DONE

## Gotchas

- State machine uses STRICT vs SOFT enforcement - STRICT transitions HALT, SOFT only WARN
- Default branch names differ by repo: check for BOTH `main` AND `master`
- Auto-archive removes A/K prompt entirely - use `--keep` flag to prevent archiving
- Open beads cause HALT at finish unless `--force` is used
- Branch suffix auto-increments (-v2, -v3) if branch already exists
- `workflow.state` for machine logic, `status` field for human readability
- Existing tracks without `workflow` object infer state from artifacts (backward compatible)

## Patterns

- **Suggestion Output Format:** Box drawing with `✓ {command} completed` and `→ Next: {suggestion}` and optional `Alt: {alternative}`
- **State History Array:** Each transition logged with `{state, at, command}` object
- **Git Preflight in Phase 0.5:** Before track creation, check branch and create if needed
- **STRICT/SOFT Transitions:** STRICT = HALT on violation, SOFT = WARN and allow recovery
- **State Inference:** For legacy tracks, infer state from artifact presence (design.md → DESIGNED, spec.md+plan.md → TRACKED, etc.)

---

**Source threads:**
- T-019b5eec-32d3-73ff-842d-ea8b41a425a1: Implementation session - state machine, suggestions, git preflight
- T-019b5ebb-e559-70f9-a41d-6d9831e5b05b: Design session - Double Diamond exploration, approach selection
