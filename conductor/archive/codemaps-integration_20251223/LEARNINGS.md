# Learnings: codemaps-integration_20251223

<!-- Auto-generated by /conductor-finish -->

## Commands

- `bd compact --analyze --json` - Find beads needing summaries
- `bd compact --apply --id <id> --summary "<text>"` - Apply AI summary to bead
- `bd count --status closed --json` - Count closed beads for cleanup threshold
- `bd cleanup --older-than 0 --limit <n> --force` - Remove oldest closed beads

## Gotchas

- Delete operations must wait for reference replacements - deleting too early causes broken references
- Phase 3 (Knowledge Merge) is required - if it fails, stop workflow
- Phases 1 & 2 are best-effort - failures should log warnings but continue

## Patterns

- **4-Phase Workflow:** Thread Compaction → Beads Compaction → Knowledge Merge → Archive
- **Smart Skip:** Each phase checks if work exists before running
- **Resume Capability:** State files track progress for interrupted workflows
- **S/H/K Archive Choice:** Soft (metadata only) / Hard (move to archive/) / Keep (stay active)

---

**Source threads:**
- T-019b4c55-7342-7360-9c20-08f5e44cee83: Epic 3 implementation (finish & refresh integration)
- T-019b4c42-6674-767f-b44d-94a2a21747af: Epic 1 infrastructure setup
