# Learnings: unify-modes

<!-- Auto-generated by /conductor-finish -->

## Commands

- `bd close id1 id2 id3 --reason completed` - Close multiple beads at once (batch close)
- `rg -i "single.?agent|multi.?agent" --type md -l | grep -v CHANGELOG | grep -v archive` - Search for SA/MA references
- `rg -i "village|\.beads-village|bv --robot" --type md -l | grep -v CHANGELOG | grep -v archive` - Search for Village references
- `rg "mode.*(detect|SA|MA)|SINGLE_AGENT" --type md -l | grep -v archive` - Search for mode detection references

## Gotchas

- **Agent Mail HALT policy:** After removing Village, Agent Mail unavailable = HALT (no fallback to sequential). This is intentional - coordination is required for parallel execution.
- **Legitimate multi-agent references:** References to "multi-agent" in architecture docs describe orchestrator's parallel capability, not the deprecated SA/MA mode distinction. Don't remove these.
- **Link validation with symlinks:** `skills/` and `.claude/skills/` are symlinked. Use `.claude/skills/` path in documentation for consistency.
- **bv commands removed:** All `bv --robot-*` commands replaced with `bd` CLI equivalents (`bd ready --json`, `bd list`, etc.)
- **Village SKILL references cleanup:** When removing Village, also remove Village-related integration points from beads SKILL.md references.

## Patterns

- **Unified Execution Mode:** Always use orchestrator, even for single-task execution (spawns 1 worker for consistency). This eliminates SA/MA branching logic.
- **Agent Mail 10-Step Worker Protocol:** register → check inbox → load context → claim → reserve files → work → close → release → notify → save context
- **HALT vs DEGRADE distinction:** `bd` unavailable = HALT; Agent Mail unavailable = HALT (changed from DEGRADE)
- **File scope parallel routing:** Tasks with different file scopes run in parallel; same files run sequentially
- **Breaking change commit:** Use `feat!:` prefix and include `BREAKING CHANGE:` in body for major architectural changes

## Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Single task handling | Orchestrator with 1 worker | Consistent flow, predictable |
| Coordination mechanism | Agent Mail only | Already robust, no Village maintenance |
| Mode detection | Remove entirely | No branching needed |
| Fallback on Agent Mail failure | HALT | Coordination is required for parallel |

---

**Source threads:**
- T-019b7e6e-93b8-706b-894c-4333967cd5a8: Continuation/verification session
- T-019b7e65-ae60-7220-9abc-9c15d92db7cd: Main implementation session
