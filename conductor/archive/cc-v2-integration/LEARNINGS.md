# Learnings: cc-v2-integration

<!-- Auto-generated by /conductor-finish -->

## Commands

<!-- CLI commands discovered -->

- `bd close <id1> <id2> --reason completed` - Close multiple beads at once
- `bd dep add <child> <parent>` - Wire dependencies after bead creation
- `bd list --json | jq '. | length'` - Count beads reliably
- `bd ready --json` - Get available tasks for orchestration
- `grep -l "send_message" skills/orchestrator/agents/**/*.md | wc -l` - Verify agent mail integration
- `mcp__mcp_agent_mail__register_agent` - Register orchestrator identity before spawning workers
- `/conductor-orchestrate` or `co` - Direct orchestrator trigger (auto-routed from `ci` when Track Assignments exist)

## Gotchas

<!-- Pitfalls, edge cases, warnings -->

- **Duplicate beads during parallel filing**: Issues created multiple times during parallel dispatch require manual closure with reason "Duplicate of X"
- **Epic status not auto-updating**: Epics remain `open` even after all child tasks closed; manually close with `bd close <epic-id> --reason completed`
- **jq array parsing**: `bd list --json` returns array, not object with "issues" key; use `jq '. | length'` not `jq '.issues | length'`
- **Wave dependencies**: Track dependencies block entire waves; Epic 4 blocked by Epic 3 blocked by Epic 2 (resolved wave-by-wave)
- **Metadata state sync**: After `fb` filing, must run `bd sync` before implementation to ensure database state is current

## Patterns

<!-- Reusable patterns -->

- **Parallel Wave Execution**: Spawn independent tracks in waves, monitor Agent Mail for completion, re-dispatch when dependencies met
- **Worker Autonomy in Orchestrator Mode**: Workers CAN claim/close beads (`bd update/close`), reserve files (`file_reservation_paths`), report via Agent Mail
- **Mandatory send_message()**: All sub-agents MUST call send_message() before returning with Status/Files/Decisions/Issues format
- **5-Category Agent Directory**: research/ review/ planning/ execution/ debug/ under skills/orchestrator/agents/
- **Agent Mail as Primary Handoff Storage**: Send to Agent Mail first for FTS5 search, markdown files secondary for git history
- **First-Message Context Load**: fetch_inbox() on session start to load prior context without hooks (Amp-specific)

---

**Source threads:**

- T-019b74e2-9ce1-7473-ae04-80461abd28a1: Orchestration execution (PurpleSnow, 3 waves)
- T-019b74d2-c39e-72fa-9cf2-6e4da4b7a38d: Beads filing and review (fb/rb)
