# Unified design.md Template

Template for design.md generated by both `ds` (Double Diamond) and `pl` (Planning Pipeline) modes.

## Template

```markdown
# Design: <Feature Name>

Generated: <date>
Mode: <ds | pl>
Track ID: <track-id>

---

## 1. Problem Statement

<From ds DISCOVER phase or pl Discovery phase>

### Goals
- Primary objective
- Secondary objectives

### Non-Goals
- Explicit exclusions
- Out of scope items

---

## 2. Discovery

### Architecture Snapshot
- Relevant packages: ...
- Key modules: ...
- Entry points: ...

### Existing Patterns
- Similar implementation: <file> does X using Y pattern
- Reusable utilities: ...
- Naming conventions: ...

### Technical Constraints
- Node version: ...
- Key dependencies: ...
- Build requirements: ...

### External References
- Library docs: ...
- Similar projects: ...

---

## 3. Approach

### Gap Analysis (pl mode)

| Component | Have | Need | Gap |
|-----------|------|------|-----|
| ... | ... | ... | ... |

### Risk Map (pl mode)

| Component | Risk | Reason | Verification |
|-----------|------|--------|--------------|
| Stripe SDK | HIGH | New external dep | Spike |
| User entity | LOW | Follows existing | Proceed |

### Recommended Approach

<Description of chosen strategy>

### Alternative Approaches

1. <Option A> - Tradeoff: ...
2. <Option B> - Tradeoff: ...

---

## 4. Design

### Core Concept

<High-level design description>

### Key Decisions

| Decision | Rationale |
|----------|-----------|
| Use X over Y | Because... |

### Interfaces

```typescript
// Key interfaces/types
interface Example {
  field: Type;
}
```

---

## 5. Spike Results (pl mode, if any)

### Spike: <question>

- **Result**: YES / NO
- **Learnings**: Key insights discovered
- **Code reference**: `conductor/spikes/<track>/spike-xxx/`
- **Impact on design**: How this affected approach

### Spike: <another question>

- **Result**: YES / NO
- **Learnings**: ...
- **Code reference**: ...

---

## 6. Track Planning (pl mode, if parallel execution expected)

### Tracks Summary

| Track | Agent | Beads | File Scope |
|-------|-------|-------|------------|
| A | BlueLake | 3 | `packages/sdk/**` |
| B | GreenCastle | 2 | `packages/cli/**` |

### Cross-Track Dependencies

- Track B can start after bead bd-11 (Track A) completes
- Track C has no cross-track dependencies

### Key Learnings (from Spikes)

Summarized here for orchestrator reference:
- <learning 1>
- <learning 2>

(Full Track Assignments go into plan.md)
```

## Section Mapping by Mode

| Section | ds Mode | pl Mode |
|---------|---------|---------|
| 1. Problem Statement | DISCOVER phase | Discovery phase |
| 2. Discovery | DISCOVER + research | Discovery phase (parallel agents) |
| 3. Approach | DEFINE phase | Synthesis phase (Oracle) |
| 4. Design | DEVELOP + VERIFY | From approach decisions |
| 5. Spike Results | Optional | Required for HIGH risk |
| 6. Track Planning | Optional | Required for parallel execution |

## Mode-Specific Notes

### ds Mode (Double Diamond)

- Sections 1-4 are primary
- Section 5 only if spikes were needed
- Section 6 only if Track Assignments already known
- A/P/C checkpoints between phases

### pl Mode (Planning Pipeline)

- All sections populated
- Section 5 required if any HIGH risk items existed
- Section 6 required if â‰¥2 parallel tracks identified
- Validation gates between phases

## Metadata Tracking

```json
{
  "workflow": {
    "state": "DESIGN",
    "mode": "planning",
    "design_path": "pl"
  },
  "planning": {
    "state": "track_planned",
    "phases_completed": ["discovery", "synthesis", "verification", "decomposition", "validation", "track_planning"]
  }
}
```

## Related

- [pipeline.md](pipeline.md) - 6-phase planning flow
- [spikes.md](spikes.md) - Spike workflow

> **Cross-skill reference:** Load the [conductor](../../conductor/SKILL.md) skill for track creation (`/conductor-newtrack`) workflow.
