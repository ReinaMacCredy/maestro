# Track Completion Protocol

When ALL phases are complete, execute this protocol.

---

## 8.1: Mark Track Complete

Edit `.maestro/tracks.md`: Change track marker from `[~]` to `[x]`.

Update metadata:
```json
{
  "status": "completed",
  "updated_at": "{ISO timestamp}"
}
```

## 8.1.5: Record Skill Effectiveness

If the completed track had skills in `metadata.json` (non-empty `"skills"` array):

1. Extract the top 5 keywords from the track's description and task titles
2. Read `.maestro/context/skill-mappings.md` (if it exists)
3. If the file doesn't exist, create it:

```markdown
# Skill Mappings

> Auto-generated by maestro:implement on track completion.
> Used by maestro:new-track to pre-match skills for similar tracks.

## Mappings

| Track Type | Keywords | Skills | Last Used |
|------------|----------|--------|-----------|
```

4. Check if a row already exists with the same track type AND 2+ overlapping keywords:
   - If yes: merge any new skill names into the Skills column, update the Last Used date
   - If no: append a new row

5. Include the file in the Step 8.4 commit:
   ```bash
   git add .maestro/context/skill-mappings.md
   ```

No user confirmation required -- this is automatic on successful track completion.

## 8.2: Documentation Sync

Read the track spec and check if project docs need updating:

1. **Product definition** (`product.md`): Does this track add a new capability?
2. **Tech stack** (`tech-stack.md`): Were new technologies introduced?
3. **Guidelines** (`guidelines.md`): Did this track establish new patterns?

**WARNING: Product guidelines should only be updated for strategic shifts. Most tracks should NOT trigger guidelines changes.**

For each proposed change, show an embedded diff (before/after) in the question:

Ask the user: "This track adds {capability}. Update product.md to include it?\n\nBEFORE:\n{existing_content_excerpt}\n\nAFTER:\n{proposed_content_excerpt}"
Options:
- **Yes, update** -- Add to project documentation
- **Skip** -- Don't update documentation

If approved, make the update and commit:
```bash
git add .maestro/context/{file}
git commit -m "docs(maestro): synchronize docs for track '{track_description}'"
```

After all doc update decisions are made, output a final sync report:
```
## Documentation Sync Report

**Track**: {track_description}

| File | Action | Reason |
|------|--------|--------|
| product.md | Updated | Added {capability} |
| tech-stack.md | Skipped | No new technologies |
| guidelines.md | Skipped | No strategic shift |
```

## 8.3: Track Cleanup

Ask the user: "Track '{description}' is complete. What would you like to do with it?"
Options:
- **Review first** -- Run /maestro:review before deciding
- **Archive** -- Move to .maestro/archive/{track_id}/
- **Keep** -- Leave in tracks/ for reference
- **Delete** -- Permanently remove track files

- **Review first**: Run `/maestro:review {track_id}` and return to this cleanup step afterward
- **Archive**: `mkdir -p .maestro/archive && mv .maestro/tracks/{track_id} .maestro/archive/`
- **Keep**: No action
- **Delete**: First confirm with a second question:

  Ask the user: "WARNING: This will permanently delete the track folder and all its contents. This action cannot be undone. Are you sure you want to delete track '{track_id}'?"
  Options:
  - **Yes, delete permanently** -- Remove all track files
  - **Cancel** -- Go back to cleanup options

  If confirmed: `rm -rf .maestro/tracks/{track_id}`
  If cancelled: return to the cleanup options question.

## 8.4: Final Commit

```bash
git add .maestro/
git commit -m "chore(maestro): complete track {track_id}"
```

## 8.5: Summary

```
## Track Complete

**{track description}** -- all {task_count} tasks across {phase_count} phases finished.

**Commits**: {list of task SHAs}
**Next**: `/maestro:review {track_id}` to verify, or `/maestro:new-track` for next feature.
```
