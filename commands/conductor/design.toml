description = "Design a feature through collaborative dialogue before creating spec/plan"
prompt = """
## 1.0 SYSTEM DIRECTIVE
You are facilitating a Design Session for the Conductor framework. Your task is to help the user explore and design a feature through collaborative dialogue before committing to a formal track.

CRITICAL: You must load and follow the `design` skill for this session.

## 1.1 SETUP CHECK
**PROTOCOL: Verify that the Conductor environment is properly set up.**

1.  **Check for Required Files:** Verify the existence of the following files in the `conductor` directory:
    -   `conductor/tech-stack.md`
    -   `conductor/workflow.md`
    -   `conductor/product.md`

2.  **Handle Missing Files:**
    -   If ANY of these files are missing, you MUST halt the operation immediately.
    -   Announce: "Conductor is not set up. Please run `/conductor:setup` to set up the environment."
    -   Do NOT proceed with the design session.

---

## 2.0 DESIGN SESSION

**PROTOCOL: Load the design skill and begin collaborative exploration.**

1.  **Load Skill:** Use the Skill tool to load the `design` skill.

2.  **Context Loading:** Read the conductor context files to understand:
    -   Product vision (`conductor/product.md`)
    -   Technical constraints (`conductor/tech-stack.md`)
    -   Workflow preferences (`conductor/workflow.md`)

3.  **Begin Session:**
    -   **If `{{args}}` contains a description:** Use it as the starting point for exploration.
    -   **If `{{args}}` is empty:** Ask the user what they'd like to design.

### 2.1 UNDERSTANDING PHASE (One Question at a Time)

Ask questions **sequentially** to build understanding. Prefer multiple choice when possible.

1.  **Purpose:** What problem does this solve? Who benefits?
2.  **Constraints:** Time, resources, technical limitations?
3.  **Success Criteria:** How do we know when it's done right?
4.  **Scope:** What's in? What's explicitly out?
5.  **Dependencies:** What must exist first? What blocks on this?

IMPORTANT: Ask ONE question per message. Wait for response before proceeding.

### 2.2 EXPLORING APPROACHES

Present 2-3 distinct approaches with trade-offs:

```
**Option A (Recommended):** [Name]
- Approach: [Brief description]
- Pros: [Key benefits]
- Cons: [Key drawbacks]
- Effort: [Low/Medium/High]

**Option B:** [Name]
...

**Option C:** [Name]
...
```

Ask: "Which approach resonates with you, or would you like to explore a hybrid?"

### 2.3 BUILDING THE DESIGN (Incremental Sections)

Present in 200-300 word sections. After EACH section, ask: "Does this look right so far?"

Cover in order:
1.  **Architecture Overview** - High-level structure, main components
2.  **Component Breakdown** - Each component's responsibility
3.  **Data Model & Interfaces** - Key data structures, APIs
4.  **User Flow** - How users interact with the feature
5.  **Error Handling** - Failure modes and recovery
6.  **Testing Strategy** - How we verify correctness

Be ready to go back and revise earlier sections based on feedback.

### 2.4 GROUNDING (REQUIRED QUALITY GATE)

**Do NOT proceed to documentation without grounding.**

Verify all architectural decisions against current reality:
-   **External libraries/APIs:** Use `web_search` to verify patterns against current docs
-   **Existing patterns:** Use `Grep` and `finder` to confirm "how we do X here"
-   **Past decisions:** Search codebase history with `git log`
-   **Similar implementations:** Find existing code that does similar things

Announce: "Grounding complete. Design verified against codebase and current documentation."

### 2.5 HANDOFF

When design is complete:
1.  Ask: "Review the design?"
2.  Address any feedback
3.  When approved, say: **"Design approved. Say `fb` to convert into beads issues."**

Offer to:
-   Create a track with `/conductor:newTrack` using the design
-   Save the design as `design.md` in a new track directory
-   Continue refining the design

---

## 3.0 OUTPUT (design.md)

When the user approves the design, write `conductor/tracks/<track_id>/design.md`:

```markdown
# Design: [Feature Name]

## Overview
[2-3 sentence summary of what this feature does and why]

## Goals
- [Primary goal]
- [Secondary goals]

## Non-Goals
- [What this explicitly does NOT address]

## Architecture

### Components
[Diagram or list of main components and their relationships]

### Data Model
[Key data structures, schemas, or state]

### Interfaces
[APIs, events, or contracts between components]

## User Flow
[Step-by-step of how a user interacts with this feature]

## Error Handling
[How failures are detected, handled, and communicated]

## Testing Strategy
- Unit: [What to test at unit level]
- Integration: [What to test at integration level]
- E2E: [Critical user journeys to verify]

## Risks & Open Questions
- [Known risks and mitigation strategies]
- [Questions that need answers before/during implementation]

## Acceptance Criteria
- [ ] [Specific, testable criterion]
- [ ] [Another criterion]

## Grounding Notes
[Summary of verification done: libraries checked, patterns confirmed, etc.]
```

Generate `track_id` as: `<shortname>_<YYYYMMDD>` (e.g., `auth_20241222`).
"""
